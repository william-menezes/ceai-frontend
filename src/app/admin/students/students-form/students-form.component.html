<p-toolbar>
  <div class="p-toolbar-group-start flex flex-column align-items-start">
    <p-button
      label="Voltar"
      icon="pi pi-arrow-left"
      [text]="true"
      (onClick)="voltar()"
    />

    <h2>{{ header | titlecase}} aluno</h2>
  </div>
</p-toolbar>

<p-panel [toggleable]="false">
  <form [formGroup]="studentForm" #form="ngForm" (ngsubmit)="onSubmit()">
    <p-tabView>
      <p-tabPanel header="Informações pessoais">
        <div class="formgrid grid row-gap-5">
          <div class="col-12 md:col-8 form-field">
            <label for="nome">Nome</label>
            <input
              pInputText
              id="nome"
              formControlName="nome"
              oninput="this.value = this.value.toUpperCase()"
            />
          </div>

          <div class="col-12 md:col-2 form-field">
            <label for="sexo">Sexo</label>
            <p-dropdown
              formControlName="sexo"
              [options]="sexOptions"
              optionLabel="value"
              optionValue="value"
            />
          </div>

          <div class="col-12 md:col-2 form-field">
            <label for="dataNascimento">Nascimento</label>
            <p-calendar
              formControlName="dataNascimento"
              dateFormat="dd/mm/yy"
            />
          </div>

          <div class="col-12 md:col-3 form-field">
            <label for="rg">RG</label>
            <input
              pInputText
              formControlName="rg"
              oninput="this.value = this.value.toUpperCase()"
            />
          </div>

          <div class="col-12 md:col-3 form-field">
            <label for="orgaoExpedidor">Órgão expedidor</label>
            <input
              pInputText
              formControlName="orgaoExpedidor"
              oninput="this.value = this.value.toUpperCase()"
            />
          </div>

          <div class="col-12 md:col-3 form-field">
            <label for="dataExpedicao">Expedição</label>
            <p-calendar formControlName="dataExpedicao" dateFormat="dd/mm/yy" />
          </div>

          <div class="col-12 md:col-3 form-field">
            <label for="cpf">CPF</label>
            <p-inputMask
              formControlName="cpf"
              mask="999.999.999-99"
              maxlength="14"
            />
          </div>

          <div class="col-12 md:col-6 form-field">
            <label for="nomeMae">Mãe</label>
            <input
              pInputText
              formControlName="nomeMae"
              oninput="this.value = this.value.toUpperCase()"
            />
          </div>

          <div class="col-12 md:col-6 form-field">
            <label for="naturalidade">Naturalidade</label>
            <input
              pInputText
              formControlName="naturalidade"
              oninput="this.value = this.value.toUpperCase()"
            />
          </div>
        </div>
      </p-tabPanel>

      <p-tabPanel header="Endereço">
        <div class="formgrid grid row-gap-5">
          <div class="col-12 md:col-2 form-field">
            <label for="cep">CEP</label>
            <p-inputMask
              formControlName="cep"
              mask="99999-999"
              maxlength="9"
              (focusout)="getAddress()"
            />
          </div>

          <div class="col-12 md:col-8 form-field">
            <label for="endereco">Endereço</label>
            <input
              pInputText
              id="endereco"
              formControlName="endereco"
              oninput="this.value = this.value.toUpperCase()"
            />
          </div>

          <div class="col-12 md:col-2 form-field">
            <label for="numero">Nº</label>
            <input
              pInputText
              pKeyFilter="num"
              id="numero"
              formControlName="numero"
            />
          </div>

          <div class="col-12 md:col-6 form-field">
            <label for="bairro">Bairro</label>
            <p-dropdown
              formControlName="bairro"
              [editable]="true"
              [showClear]="true"
              [filter]="true"
              filterBy="value"
              [options]="bairrosOptions"
              optionLabel="value"
              optionValue="id"
              placeholder="Bairro"
            />
          </div>

          <div class="col-12 md:col-6 form-field">
            <label for="complemento">Complemento</label>
            <input
              pInputText
              id="complemento"
              formControlName="complemento"
              oninput="this.value = this.value.toUpperCase()"
            />
          </div>
        </div>
      </p-tabPanel>

      <p-tabPanel header="Contato">
        <form formArrayName="contatos" class="flex flex-column flex-wrap gap-5">
          <ng-container
            *ngFor="let contato of contatos().controls; let contatoId = index"
            [formGroupName]="contatoId"
          >

          <div class="formgrid grid row-gap-5" >
            <div class="col-12 md:col-3 form-field">
              <label for="contato">Telefone {{contatoId+1}}</label>
              <p-inputMask
                formControlName="contato"
                mask="(99) ?9 9999-9999"
                maxlength="16"
              />
            </div>

            <div class="col-12 md:col-5 form-field">
              <label for="responsavel">Responsável</label>
              <input
                pInputText
                id="responsavel"
                formControlName="responsavel"
                oninput="this.value = this.value.toUpperCase()"
              />
            </div>

            <div class="col-12 md:col-3 form-field">
              <label for="parentesco">Parentesco</label>
              <p-dropdown
                formControlName="parentesco"
                [options]="parentescoContatoOptions"
                optionLabel="value"
                optionValue="id"
              />
            </div>

            <div class="col-12 md:col-1 flex align-items-end">
              @if (width > 768) {
              <p-button
                icon="pi pi-trash"
                [rounded]="true"
                [text]="true"
                severity="danger"
                (click)="removerContato(contatoId)"
              />
              } @else {
              <p-button
                icon="pi pi-trash"
                [outlined]="true"
                severity="danger"
                label="Remover contato"
                (click)="removerContato(contatoId)"
              />
              }
            </div>

          </div>
        </ng-container>

        <p-button
        icon="pi pi-plus"
        [outlined]="true"
        severity="secondary"
        size="small"
        label="Adicionar contato"
        (click)="adicionarContato()"
      />
        </form>
      </p-tabPanel>

      <p-tabPanel header="Histórico">
        <div class="formgrid grid row-gap-5"></div
      ></p-tabPanel>

      <p-tabPanel header="Grade horária">
        <div class="formgrid grid row-gap-5"></div
      ></p-tabPanel>
    </p-tabView>
  </form>

  <p-button label="Salvar" (click)="onSubmit()"></p-button>
</p-panel>
